<!DOCTYPE html>
<html lang="vi" ng-app="loginApp">
<head>
  <meta charset="UTF-8">
  <title>Đăng nhập</title>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body ng-controller="LoginController" class="d-flex justify-content-center align-items-center vh-100 bg-light">

<div class="card p-4 shadow" style="width: 400px;">
  <h4 class="text-center mb-3">Đăng nhập</h4>

  <div class="alert alert-danger" ng-if="errorMessage">{{errorMessage}}</div>
  <div class="alert alert-success" ng-if="successMessage">{{successMessage}}</div>

  <form ng-submit="login()">
    <div class="mb-3">
      <label for="email">Email</label>
      <input type="email" id="email" class="form-control" ng-model="user.email" required>
    </div>

    <div class="mb-3">
      <label for="password">Mật khẩu</label>
      <input type="password" id="password" class="form-control" ng-model="user.password" required>
    </div>

    <div class="form-check mb-3">
      <input type="checkbox" id="rememberMe" class="form-check-input" ng-model="user.rememberMe">
      <label for="rememberMe" class="form-check-label">Ghi nhớ đăng nhập</label>
    </div>

    <button type="submit" class="btn btn-primary w-100">Đăng nhập</button>
  </form>

  <div class="mt-3 text-center">
    <a href="/DangKy">Chưa có tài khoản? Đăng ký</a>
  </div>
</div>

<script>
  var app = angular.module('loginApp', []);

  app.controller('LoginController', function ($scope, $http, $window) {
    $scope.user = {};

    $scope.login = function () {
      $http.post("http://localhost:8080/auth/api/login", $scope.user)
              .then(function (response) {
                const data = response.data;
                $scope.successMessage = data.message;
                $scope.errorMessage = null;

                setTimeout(function () {
                  $window.location.href = data.user.redirectUrl;
                }, 1000);
              }, function (error) {
                $scope.errorMessage = error.data.message || "Lỗi không xác định!";
                $scope.successMessage = null;
              });
    };
  });
</script>

</body>
</html>
